import matplotlib.pyplot as plt
import numpy as np

# ----------------------------------------------------
# MODELS
# ----------------------------------------------------
models = [
    "Holt-Winters", "GPR", "BSTS", "CatBoost", "RF",
    "Decision Tree", "Gradient Boosting", "GRU",
    "CNN-LSTM", "N-BEATS"
]

# ----------------------------------------------------
# DATA FOR ALL COUNTRIES
# ----------------------------------------------------
data_full = {
    "India": {
        "MSE": [41781.6006, 30843.5835, 7472.9558, 1201609.2868, 680199.1527, 732211.1984, 605245.6628, 81927.6006, 107593.6758, 1033690.1216],
        "RMSE": [204.4055, 175.6234, 86.4463, 1096.1794, 824.7419, 855.6934, 777.9754, 286.23, 328.0147, 1043.5887],
        "MSLE": [0.0033, 0.0025, 0.0007, 0.1723, 0.0822, 0.0911, 0.0716, 0.0722, 0.0811, 0.0616],
        "MAPE": [4.5349, 3.7875, 2.0584, 32.5110, 23.4616, 24.1484, 21.6116, 11.8910, 13.6271, 24.7266],
        "Median AE": [97.0633, 77.3809, 52.2431, 1006.6353, 756.9051, 867.6400, 707.5462, 240.8428, 267.8073, 2274.8282],
        "Max Error": [0.5335, 0.6556, 0.9166, -12.4158, -6.5943, -7.1750, -5.7575, 0.2920, 0.0702, -132.1783],
        "Explained Variance": [489.1163, 447.4125, 176.9133, 1786.0769, 1313.4858, 1349.8600, 1253.6190, 460.1392, 526.3731, 2537.1371],
        "R2": [0.82, 0.88, 0.93, 0.75, 0.79, 0.80, 0.82, 0.89, 0.86, 0.77],
        "Accuracy": [95.4651, 96.2125, 97.9416, 87.4890, 88.5384, 80.8516, 82.3884, 88.1090, 86.3729, 89.2734]
    },

    "Canada": {
        "MSE": [110023.0102, 6220.0037, 59566.6645, 34701.1757, 41031.2776, 40089.3018, 42067.3581, 9671.8051, 19246.8897, 40505.8043],
        "RMSE": [331.6972, 78.8670, 244.0628, 186.2825, 202.5618, 200.2231, 205.1033, 98.3453, 138.7332, 201.2605],
        "MSLE": [0.1233, 0.0091, 0.0737, 0.0458, 0.0531, 0.0520, 0.0543, 0.0529, 0.0519, 0.0533],
        "MAPE": [40.3766, 9.2409, 30.1496, 22.7522, 25.2125, 24.8761, 25.5370, 8.3824, 12.4358, 24.8149],
        "Median AE": [348.2775, 74.2776, 262.0114, 198.0181, 205.2040, 203.6150, 207.7648, 86.7184, 134.7748, 206.2043],
        "Max Error": [-46.8719, -1.7064, -24.9179, -14.0988, -16.8530, 16.4432, -17.3038, 0.0630, -0.8646, -15.9285],
        "Explained Variance": [460.9316, 122.1921, 330.4272, 263.1438, 259.4006, 263.4300, 263.4300, 194.2588, 208.3709, 248.7258],
        "R2": [0.78, 0.91, 0.82, 0.87, 0.84, 0.85, 0.83, 0.93, 0.90, 0.84],
        "Accuracy": [80.6234, 90.7591, 87.8504, 85.2478, 88.7875, 85.1239, 85.4630, 91.6176, 87.5642, 88.1851]
    },

    "Japan": {
        "MSE": [41781.6006, 8371.6262, 12672.4337, 7784.2149, 9435.1105, 40089.3018, 6785.0657, 1190.5855, 1769.5608, 20244.1816],
        "RMSE": [204.4055, 91.4966, 112.5719, 88.2282, 97.1345, 200.2231, 82.3715, 34.5049, 42.0661, 142.2820],
        "MSLE": [0.0033, 0.0061, 0.0092, 0.0056, 0.0068, 0.0520, 0.0049, 0.0520, 0.0515, 0.0047],
        "MAPE": [4.5349, 6.9304, 8.3297, 6.8637, 7.1640, 24.8761, 5.6873, 2.1612, 2.4061, 9.8883],
        "Median AE": [97.0633, 89.2798, 100.2982, 74.1113, 77.0481, 203.6150, 66.3655, 16.8876, 13.0406, 149.2869],
        "Max Error": [0.5335, -0.1829, -0.7906, -0.0999, -0.3332, 16.4432, 0.0413, 0.0304, -0.4411, -2.4753],
        "Explained Variance": [489.1163, 142.5704, 187.3048, 140.6492, 161.9572, 263.4300, 173.9871, 93.1888, 116.2564, 240.1684],
        "R2": [0.87, 0.89, 0.85, 0.90, 0.88, 0.72, 0.91, 0.97, 0.96, 0.86],
        "Accuracy": [95.4651, 93.0696, 91.6703, 93.1363, 92.8360, 75.1239, 94.3127, 97.8388, 97.5939, 90.1117]
    },

    "Russia": {
        "MSE": [20015.9191, 70176.5327, 254145.1314, 60855.6992, 69666.5203, 69760.1627, 73694.5620, 18031.4797, 16160.7696, 129849.6654],
        "RMSE": [141.4776, 264.9085, 504.1281, 246.6895, 263.9442, 264.1215, 271.4674, 134.2813, 127.1250, 360.3466],
        "MSLE": [0.0152, 0.0275, 0.1264, 0.0236, 0.0273, 0.0274, 0.0291, 0.0289, 0.0278, 0.0293],
        "MAPE": [10.8708, 13.8779, 25.9069, 11.9392, 13.7413, 13.8988, 14.3544, 7.7594, 6.9470, 20.1186],
        "Median AE": [141.5988, 239.8419, 441.5258, 190.7671, 207.6198, 206.0533, 223.9504, 97.3627, 89.1430, 338.5820],
        "Max Error": [-1.8283, -5.4055, -22.1977, -4.5548, -5.3590, -5.3675, -5.7267, -0.3493, -0.2093, -10.2386],
        "Explained Variance": [213.0588, 437.2201, 845.7914, 446.9989, 457.6684, 450.5600, 457.5179, 264.6409, 235.8024, 533.6120],
        "R2": [0.91, 0.85, 0.73, 0.87, 0.86, 0.84, 0.82, 0.92, 0.93, 0.79],
        "Accuracy": [89.1292, 86.1221, 84.0931, 88.0608, 86.2587, 86.1012, 85.6456, 92.2406, 93.0530, 80.8814]
    }
}

# ----------------------------------------------------
# METRICS TO PLOT
# ----------------------------------------------------
metrics = [
    "MSE", "RMSE", "MSLE", "MAPE",
    "Median AE", "Max Error",
    "Explained Variance", "R2", "Accuracy"
]

captions = [
    "Figure 4(a): Mean Squared Error (MSE)",
    "Figure 4(b): Root Mean Squared Error (RMSE)",
    "Figure 4(c): Mean Squared Log Error (MSLE)",
    "Figure 4(d): Mean Absolute Percentage Error (MAPE)",
    "Figure 4(e): Median Absolute Error",
    "Figure 4(f): Maximum Error",
    "Figure 4(g): Explained Variance Score",
    "Figure 4(h): R² Score",
    "Figure 4(i): Accuracy (%)"
]

colors = ["#008080", "#4682B4", "#FFA500", "#556B2F"]  # four countries

# ----------------------------------------------------
# CREATE 3×3 FIGURE
# ----------------------------------------------------
fig, axes = plt.subplots(3, 3, figsize=(25, 18))
axes = axes.flatten()

for idx, metric in enumerate(metrics):
    ax = axes[idx]
    x = np.arange(len(models))
    width = 0.2

    for c, (country, vals) in enumerate(data_full.items()):
        y = vals[metric]
        y = [v if v is not None else np.nan for v in y]
        ax.bar(x + c * width, y, width=width, label=country, color=colors[c])

    ax.set_title(metric, fontsize=15, fontweight="bold")
    ax.set_xticks(x + width * 1.5)
    ax.set_xticklabels(models, rotation=45, ha="right")
    ax.grid(axis="y", linestyle="--", alpha=0.5)

    # Add caption below subplot
    ax.text(0.5, -0.32, captions[idx], ha='center',
            fontsize=12, transform=ax.transAxes)

# ----------------------------------------------------
# GLOBAL SETTINGS
# ----------------------------------------------------
fig.legend(data_full.keys(), loc="upper center", ncol=4, fontsize=14)
plt.suptitle("Combined Performance Metrics of Forecasting Models Across Four Countries",
             fontsize=20, fontweight='bold')

plt.tight_layout(rect=[0, 0, 1, 0.95])
plt.show()
